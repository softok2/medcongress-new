<div class="modal fade " id="{{modal_id}}" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog "
        role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Editar la Imagen</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="img-container ">
                    <img id="{{imagen_id}}"
                        src="https://avatars0.githubusercontent.com/u/3456749">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal">Cancel</button>
                <button type="button"
                    class="btn btn-primary"
                    id="{{crop_id}}">Guardar</button>
            </div>
        </div>
    </div>
</div>
<script>
window.addEventListener('DOMContentLoaded', function () {
    var avatar = document.getElementById('{{avatar_id}}');
    var image = document.getElementById('{{imagen_id}}');
    var input = document.getElementById('{{input_id}}');
    var $alert = $('#{{alert_id}}');
    var $modal = $('#{{modal_id}}');
    var cropper;

    $('[data-toggle="tooltip"]').tooltip();

    input.addEventListener('change', function (e) {
        var imgsize = input.files[0].size;
        if(imgsize > 5000000){
            
            $alert.show().addClass('alert-success alert-warning').text('Esta imagen supera los 5Mb.');
        
        return;
        }
                var files = e.target.files;
        var done = function (url) {
            input.value = '';
            image.src = url;
            $alert.hide();
            $modal.modal('show');
        };
        var reader;
        var file;
        var url;

        if (files && files.length > 0) {
            file = files[0];

            tipo_imagen=files[0].name.split('.');
        if(tipo_imagen[1]!='jpg' && tipo_imagen[1]!='png' && tipo_imagen[1]!='jpeg')
        {
            
            swal("Cancelado", "Solo admimite archivos .jpeg , .jpg y .png.", "error");
            return;	
        }
            if (URL) {
                done(URL.createObjectURL(file));
            } else if (FileReader) {
                reader = new FileReader();
                reader.onload = function (e) {
                    done(reader.result);
                };
                reader.readAsDataURL(file);
            }
        }
    });

    $modal.on('shown.bs.modal', function () {


        $('#image').width($modal.width());


        cropper = new Cropper(image, {
            aspectRatio: {{ancho}} / {{alto}},
            viewMode: 1,


            ready: function () {
                //Should set crop box data first here
                cropper.setCropBoxData(cropBoxData).setCanvasData(canvasData);
            }
        });
    }).on('hidden.bs.modal', function () {
        cropper.destroy();
        cropper = null;
    });

    // document.getElementById('crop').addEventListener('click', function () {

    //     var initialAvatarURL;
    //     var canvas;

    //     $modal.modal('hide');

    //     if (cropper) {
    //         canvas = cropper.getCroppedCanvas({
    //             width:  1920,
    //             height: 682,
    //         });
    //         initialAvatarURL = avatar.src;
    //         //   avatar.src = canvas.toDataURL();

    //         $('#imagenes').prepend(`<figure class="col-sm-3 " id="` + id + `"><div class="row"><div class="col-md-12">
    //                                                     <img class="img-fluid"  src="`+ canvas.toDataURL() + `"  alt="imagen" >
    //                                                     </div>
                                                    
                                                    
    //                                             </div>
    //                                             <button class="btn " type="button" onclick="deleteImagen('`+ id + `')" title="Eliminar Imagen"> <i class="icon icon-eliminar"></i></button>
    //                                             </figure>
    //                                             `);

    //         $("#congres-form").append("<input type='hidden' id='imagen_" + id + "' name='congreso-prueba' value='" + canvas.toDataURL() + "'>");
    //         //   $("<input>").attr("type", "hidden").attr("name", "").appendTo("form").val(canvas.toDataURL()); 
    //         //   $('#prueba').val(canvas.toDataURL());
    //         id = id + 1;

    //         $alert.removeClass('alert-success alert-warning');
    //         $alert.show().addClass('alert-success').text('Nueva Imagen Cargada');

    //     }
    // });

    document.getElementById('{{crop_id}}').addEventListener('click', function () {

        var initialAvatarURL1;
        var canvas1;

        $modal.modal('hide');

        if (cropper) {
            canvas1 = cropper.getCroppedCanvas({
                width: {{ancho}},
                height: {{alto}},
            });
            initialAvatarURL1 = avatar.src;
            {% if not varias%}
            avatar.src = canvas1.toDataURL();
            $('#{{input_hidden}}').val(canvas1.toDataURL());
            $('#{{div}}').html(`<img class="img-fluid" id="{{avatar_id}}" src="` + canvas1.toDataURL() + `"  alt="avatar">`);
            {%else%}
            initialAvatarURL = avatar.src;
            //   avatar.src = canvas.toDataURL();

            $('#imagenes').prepend(`<figure class="col-sm-3 " id="` + id + `"><div class="row"><div class="col-md-12">
                                                        <img class="img-fluid"  src="`+ canvas1.toDataURL() + `"  alt="imagen" >
                                                        </div>
                                                    
                                                    
                                                </div>
                                                <button class="btn " type="button" onclick="deleteImagen('`+ id + `')" title="Eliminar Imagen"> <i class="icon icon-eliminar"></i></button>
                                                </figure>
                                                `);

            $("#congres-form").append("<input type='hidden' id='imagen_" + id + "' name='congreso-prueba' value='" + canvas1.toDataURL() + "'>");
            //   $("<input>").attr("type", "hidden").attr("name", "").appendTo("form").val(canvas.toDataURL()); 
            //   $('#prueba').val(canvas.toDataURL());
            id = id + 1;
            {%endif%}

            $alert.removeClass('alert-success alert-warning');
            $alert.show().addClass('alert-success').text('Nueva Imagen Cargada');

        }
    });

   



});

</script>