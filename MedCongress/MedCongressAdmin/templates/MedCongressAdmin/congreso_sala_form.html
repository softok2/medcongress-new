{% extends 'MedCongressAdmin/base.html' %}
{% block title %}{%if update%} Actualizar Sala{%else%} Adicionar Sala{%endif%}{% endblock %}
{% load static %}
{% block styles %}
<style>
	#geomap {
		width: 100%;
		height: 400px;
	}

	.img-container img {
		max-width: 100%;
	}
</style>
<link rel="stylesheet" type="text/css" href="{% static 'MedCongressAdmin/assets/css/cropper.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'MedCongressAdmin/app-assets/vendors/css/forms/selects/select2.min.css' %}">
{% endblock %}
{% block content %}

<div class=" col-md-6 col-12 " style="margin-top: -26px;">
						
	<div class="row breadcrumbs-top">
	  <div class="breadcrumb-wrapper col-12">
		<ol class="breadcrumb">
		  <li class="breadcrumb-item"><a href="{% url 'MedCongressAdmin:congress_list' %}">Congresos</a>
		  </li>
		 
		  <li class="breadcrumb-item active"><a href="{% url 'MedCongressAdmin:Congres_salas' path=cong.path %}">Salas</a>
		</li>
		<li class="breadcrumb-item active">{%if update%} Actualizar Sala{%else%} Adicionar Salas{%endif%}
		</li>
		
		</ol>
	  </div>
	</div>
  </div>
<section class="multiple-input-with-labels" id="multiple-input-with-labels">
	<div class="row">
		<div class="col-12">
			<div class="card">
				<div class="card-header">
					<h1 class="card-header mb-0 pb-0" style="font-size: xx-large; font-weight: bolder;">
						{%if update%} Actualizar Salas{%else%} Adicionar Salas{%endif%} </h1>
					<a class="heading-elements-toggle"><i class="ft-align-justify font-medium-3"></i></a>
					<div class="heading-elements">
						<ul class="list-inline mb-0">
							<li><a data-action="collapse"><i class="ft-minus"></i></a></li>
						
							<li><a data-action="expand"><i class="ft-maximize"></i></a></li>
						
						</ul>
					</div>
				</div>
				<div class="card-content collapse show">
					<div class="card-body">
						{% if form.errors %}
						{% for field in form %}
							{% for error in field.errors %}
							
								<div class="alert alert-danger alert-dismissible mb-2" role="alert">
									<button type="button" class="close" data-dismiss="alert" aria-label="Close">
										<span aria-hidden="true">×</span>
									</button>
									{{ error|safe|escape }}
								</div>
							{% endfor %}
						{% endfor %}
						{% for error in form.non_field_errors %}
						<div class="alert alert-danger alert-dismissible mb-2" role="alert">
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<span aria-hidden="true">×</span>
							</button>
							{{ error|safe|escape }}
						</div>
						{% endfor %}
					{% endif %} 
						<form id="country-form" method="POST" enctype="multipart/form-data">
							{% csrf_token %}
							<input type="hidden" name="update" value="{%if update%}{{categoria.id}}{%else%}false{%endif%}">
							<div class="form-body">
								<div class="row">
									<div class="col-md-12">
										<div class="row">
											<div class="col-sm-8 ">
												<div class="form-group">
													<label
														for="{{form.titulo.id_for_label }}"><b>{{form.titulo.label }}</b></label>

													{{form.titulo }}
												</div>
												<div class="row">
													<div class="col-sm-12">
														<div class="form-group">
															
		
														<label for="{{form.cod_video.id_for_label }}"><b>{{form.cod_video.label}}</b> </label><br>
															{{form.cod_video}}
														
														</div>
													</div>
												</div>
											</div>
											<div class="col-sm-4 ">
												<div class="form-group">
													<label for="" >
														<b>Imagen  <span style="font-size: 80%; color: darkgrey;"> (1920 X 1080)</span></b> </label>
													{%if imagen%}
													<label class="label" data-toggle="tooltip"
														title="Clic para cambiar foto">
														<div id="ver3"><img class="img-fluid"
																id="avatar3"
																src="{%static '/'%}{{imagen}}"
																alt="avatar"></div>
														<input type="file" class="sr-only"
															id="input3" name="image"
															accept="image/*">
														<input type="hidden"
															id="imagen"
															name="imagen"
															value="{{imagen}}">
													</label>
										
													{% else%}
													<br>
													<label class="label" data-toggle="tooltip"
													title="Clic para cambiar foto">
													<div id="ver3"><span id="avatar3"> <i
																class="icon icon-add_imagen"></i></span>
													</div>
													<input type="file" class="sr-only"
														id="input3" name="imagen-"
														accept="image/*">
													<input type="hidden"
														id="imagen"
														name="imagen">
												</label>
													</label>
													{%endif%}
										
										
													<div class="alert" role="alert" id="alert3">
													</div>
													<div class="modal fade " id="modal3"
														tabindex="-1" role="dialog"
														aria-labelledby="modalLabel"
														aria-hidden="true">
														<div class="modal-dialog "
															role="document">
															<div class="modal-content">
																<div class="modal-header">
																	<h5 class="modal-title"
																		id="modalLabel">Editar
																		la Imagen</h5>
																	<button type="button"
																		class="close"
																		data-dismiss="modal"
																		aria-label="Close">
																		<span
																			aria-hidden="true">&times;</span>
																	</button>
																</div>
																<div class="modal-body">
																	<div class="img-container ">
																		<img id="image3"
																			src="https://avatars0.githubusercontent.com/u/3456749">
																	</div>
																</div>
																<div class="modal-footer">
																	<button type="button"
																		class="btn btn-secondary"
																		data-dismiss="modal">Cancel</button>
																	<button type="button"
																		class="btn btn-primary"
																		id="crop3">Guardar</button>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										
										<div class="row">
											<div class="col-sm-12">
												<div class="form-group">
													

												<label for="{{form.detalle.id_for_label }}"><b>{{form.detalle.label}}</b> </label><br>
													{{form.detalle}}
												
												</div>
											</div>
											<div class="col-sm-2 ">
												<div class="form-group">
													{{form.congreso }}
												</div>
											</div>
										</div>
										<div class="row">
											<div class="col-sm-2">
												<div class="form-group">
													

												<label for="{{form.published.id_for_label }}"><b>Publicado</b> </label><br>
													{{form.published}}
												
												</div>
											</div>
											
									
									
											<div class="col-sm-2">
												<div class="form-group">
													

												<label for="{{form.color.id_for_label }}"><b>Color</b> </label><br>
												<input type="color" name="color" value="#4A5966" maxlength="10" required="" id="id_color">
												
												</div>
											</div>
										</div>
										
									
									<div class="row">
										<div class="col-sm-12">
											<div class="form-actions">
												<div class="text-right">
													<button id="atras" type="button" class="btn btn-danger ">Cancelar
														<i class="ft-x position-right"></i>
													</button>

													<button id="save" type="submit" class="btn btn-primary">Guardar
														<i class="ft-save position-right"></i>
													</button>

												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div style="text-align: right;"> </div>
</section>
{% endblock %}
{% block scripts %}
<script src="{% static 'MedCongressAdmin/app-assets/vendors/js/forms/select/select2.full.min.js'%}"></script>
<script src="{% static 'MedCongressAdmin/app-assets/js/scripts/forms/select/form-select2.js'%}"></script>
<script src="{% static 'MedCongressAdmin/assets/js/cropper.js'%}"></script>
<script type="text/javascript">
 $('#atras').click(function () {
            location.href = "{% url 'MedCongressAdmin:Congres_salas' path=cong.path %}";
        });
	$(document).ready(function () {

		{% if sala %}
	
	$('#id_color').val('{{sala.color}}')
		{% endif%}
		$("#id_congreso option[value='{{cong.id}}']").attr("selected",true);
	
	});
	window.addEventListener('DOMContentLoaded', function () {
		
		var avatar3 = document.getElementById('avatar3');
		var image3 = document.getElementById('image3');
		var input3 = document.getElementById('input3');

		

		var $alert3 = $('#alert3');
		var $modal3 = $('#modal3');
		var cropper3;

		$('[data-toggle="tooltip"]').tooltip();


input3.addEventListener('change', function (e) {
	var files = e.target.files;
	var done = function (url) {
		input3.value = '';
		image3.src = url;
		$alert3.hide();
		$modal3.modal('show');
	};
	var reader;
	var file;
	var url;

	if (files && files.length > 0) {
		file = files[0];

		tipo_imagen=files[0].name.split('.');
	if(tipo_imagen[1]!='jpg' && tipo_imagen[1]!='png' && tipo_imagen[1]!='jpeg')
	{
		
		swal("Cancelado", "Solo admimite archivos .jpeg , .jpg y .png.", "error");
		return;	
	}
		if (URL) {
			done(URL.createObjectURL(file));
		} else if (FileReader) {
			reader = new FileReader();
			reader.onload = function (e) {
				done(reader.result);
			};
			reader.readAsDataURL(file);
		}
	}
});
$modal3.on('shown.bs.modal', function () {


$('#image3').width($modal3.width());


cropper3 = new Cropper(image3, {
	aspectRatio: 1920 / 1080,
	viewMode: 1,


	ready: function () {
		//Should set crop box data first here
		cropper3.setCropBoxData(cropBoxData).setCanvasData(canvasData);
	}
});
}).on('hidden.bs.modal', function () {
cropper3.destroy();
cropper3 = null;
});


document.getElementById('crop3').addEventListener('click', function () {

var initialAvatarURL3;
var canvas3;

$modal3.modal('hide');

if (cropper3) {
	canvas3 = cropper3.getCroppedCanvas({
		width:  1920,
		height: 1080,
	});
	initialAvatarURL3 = avatar3.src;
	avatar3.src = canvas3.toDataURL();
	$('#imagen').val(canvas3.toDataURL());
	$('#ver3').html(`<img class="img-fluid" id="avatar3" src="` + canvas3.toDataURL() + `"  alt="avatar">`);


	$alert3.removeClass('alert-success alert-warning');
	$alert3.show().addClass('alert-success').text('Nueva Imagen Cargada');

}
});




	});

</script>
{% endblock %}