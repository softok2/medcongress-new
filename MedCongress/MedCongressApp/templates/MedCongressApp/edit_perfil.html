{% extends "MedCongressApp/base.html"%}
{% load static %}
{% block titulo %}
Registrarse
{%endblock%}

{%block css%}
<link rel="stylesheet" type="text/css"
    href="{% static 'MedCongressAdmin/assets/css/cropper.css' %}">
<style>
	#geomap {
		width: 100%;
		height: 400px;
	}

	.img-container img {
      max-width: 100%;
    }
    .modal-backdrop {
   
z-index: 0;
    }
</style>

{%endblock%}
{% block contenido %}
<div class="kode-event-time">

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Localidad</h4>
                </div>
                <div class="modal-body">
                    <div id="geomap"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>

    <div class="kode-event-contact"
        style=" background:url({% static 'MedCongressApp/images/slide11.png'%}) no-repeat 50%  0;background-attachment: fixed; ">
        <div class="container">


            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="kf_heading_3" style="margin-top: 70px;">
                        <h2>Actualizar Perfil en MedCongress</h2>
                        <span></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    {% if form.errors %}
                    {% for field in form %}
                        {% for error in field.errors %}
                        
                            <div class="alert alert-danger alert-dismissible mb-2" role="alert">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">×</span>
                                </button>
                                {{ error|safe|escape }}
                            </div>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                    <div class="alert alert-danger alert-dismissible mb-2" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                        {{ error|safe|escape }}
                    </div>
                    {% endfor %}
                {% endif %}
                    <form class="contactusform" action="" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="home">
                                <div class="row">
                                    <div class="col-sm-3 ">
                                        
                                            <div class="form-group">
                                                {%if imagen_seg_url%}	
                                                <label class="label" data-toggle="tooltip" title="Clic para cambiar foto">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                        <img class="img-responsive" id="avatar" src="{% static '/' %}{{imagen_seg_url}}"  alt="avatar" >
                                                        </div>
                                                    
                                                    
                                                </div>
                                                <input type="file" class="sr-only" id="input" name="image" accept="image/*">
                                                    <input type="hidden" id="prueba" name="prueba">
                                                  </label>
                                                  
                                                {% else%}

                                                <label class="label" data-toggle="tooltip" title="Clic para cambiar foto">
                                                    <img class="img-responsive" id="avatar" id="avatar" src="{% static 'MedCongressApp/images/defaulthombre.png' %}"  alt="avatar">
                                                    <input type="file" class="sr-only" id="input" name="image" accept="image/*">
                                                    <input type="hidden" id="prueba" name="prueba">
                                                  </label>
                                                    {%endif%}
                                                    
                                                    
                                                      <div class="alert" role="alert"></div>
                                                      <div class="modal fade " id="modal1" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                                                        <div class="modal-dialog " role="document">
                                                          <div class="modal-content">
                                                            <div class="modal-header">
                                                              <h5 class="modal-title" id="modalLabel">Editar la Imagen</h5>
                                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                              </button>
                                                            </div>
                                                            <div class="modal-body">
                                                              <div class="img-container ">
                                                                <img id="image" src="https://avatars0.githubusercontent.com/u/3456749">
                                                              </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                              <button type="button" class="btn btn-primary" id="crop">Guardar</button>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    
                                           
                                        </div>
                                    </div>

                                    <div class="col-sm-9 ">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.user.first_name.id_for_label }}"><b>{{form.user.first_name.label }}</b> </label>

                                                    {{form.user.first_name }} {{form.user.first_name.help_text }}
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.user.last_name.id_for_label }}"><b>{{form.user.last_name.label }}</b> </label>

                                                    {{form.user.last_name }}
                                                </div>


                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.user.email.id_for_label }}"><b>{{form.user.email.label }}</b> </label>

                                                    {{form.user.email }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-3 " style="display: none;">
                                                <div class="form-group">
                                                    <label for="{{form.user.username.id_for_label }}"><b>{{form.user.username.label }}
                                                        </b> </label>

                                                    {{form.user.username }}
                                                </div>
                                            </div>
                                            <div class="col-sm-8 ">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.ubicacion.direccion.id_for_label }}"><b>{{form.ubicacion.direccion.label }}</b>
                                                        </label>

                                                    {{form.ubicacion.direccion }}
                                                </div>
                                            </div>
                                            
                                            <div class="col-sm-3">
                                                <div class="form-group">

                                                    <label class="mapa">Ver Mapa</label>
                                                    <!-- <a onclick="VerMapa()" type="link"  style="display: block;">  <i class="" style="font-size: 43px;"></i> </a> -->
                                                    <button type="button" class="btn btn-link" data-toggle="modal"
                                                        data-target="#myModal" style="display: block;">
                                                        <span><i class="glyphicon glyphicon-map-marker"
                                                                style="font-size: 30px;display: block;"></i></span>

                                                    </button>

                                                </div>

                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-3 ">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.perfiluser.genero.id_for_label }}"><b>{{form.perfiluser.genero.label }}</b></label>
                                                    {{form.perfiluser.genero }}
                                                </div>
                                            </div>
                                            <div class="col-sm-3 ">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.perfiluser.num_telefono.id_for_label }}"><b>{{form.perfiluser.num_telefono.label }}</b></label>

                                                    {{form.perfiluser.num_telefono }}
                                                </div>
                                            </div>
                                            <div class="col-sm-3 ">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.perfiluser.fecha_nacimiento.id_for_label }}"><b>{{form.perfiluser.fecha_nacimiento.label }}</b></label>

                                                        <input type="date" name="perfiluser-fecha_nacimiento" class="form-control" id="id_perfiluser-fecha_nacimiento">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">

                                            <div class="col-sm-3 ">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.perfiluser.categoria.id_for_label }}"><b>{{form.perfiluser.categoria.label }}</b></label>

                                                    {{form.perfiluser.categoria }}
                                                </div>
                                            </div>
                                            <div class="col-sm-3 " id="new_cat">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.categoria.nombre.id_for_label }}"><b>{{form.categoria.nombre.label }}</b></label>
                                                    {{form.categoria.nombre}}
                                                </div>
                                            </div>

                                            <div class="col-sm-3 " id="esp_div">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.perfiluser.especialidad.id_for_label }}"><b>{{form.perfiluser.especialidad.label }}</b></label>
                                                    {{form.perfiluser.especialidad }}
                                                </div>
                                            </div>
                                            <div class="col-sm-3 " id="cel_prof">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.perfiluser.cel_profecional.id_for_label }}"><b>{{form.perfiluser.cel_profecional.label }}</b></label>

                                                    {{form.perfiluser.cel_profecional }}
                                                </div>
                                            </div>

                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-sm-6 ">
                                                <div class="form-group">
                                                    {{form.perfiluser.is_ponente }}
                                                    <label for="{{form.perfiluser.is_ponente.id_for_label }}"><b>{{form.perfiluser.is_ponente.label }}
                                                    </label>

                                                </div>
                                            </div>

                                            <div class="col-sm-3 ">
                                                <div class="form-group" style="display: none;">
                                                    <label
                                                        for="{{form.ubicacion.longitud.id_for_label }}"><b>{{form.ubicacion.longitud.label }}</b></label>

                                                    {{form.ubicacion.longitud }}
                                                </div>
                                            </div>
                                            <div class="col-sm-3 " style="display: none;">
                                                <div class="form-group">
                                                    <label
                                                        for="{{form.ubicacion.latitud.id_for_label }}"><b>{{form.ubicacion.latitud.label }}</b> </label>

                                                    {{form.ubicacion.latitud }}
                                                </div>
                                            </div>



                                        </div>
                                        
                                    </div>


                                </div>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="profile">
                                <div class="row">
                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <label for="{{form.perfiluser.puesto.id_for_label }}"><b>Puesto
                                                    Actual</b></label>

                                            {{form.perfiluser.puesto }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="{{form.perfiluser.detalle.id_for_label }}"><b>Logros
                                                    Académicos</b></label>

                                            {{form.perfiluser.detalle }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label
                                                for="{{form.perfiluser.publicaciones.id_for_label }}"><b>Publicaciones</b></label>

                                            {{form.perfiluser.publicaciones }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="{{form.perfiluser.datos_interes.id_for_label }}"><b>Otros Datos
                                                    de
                                                    Interes</b></label>

                                            {{form.perfiluser.datos_interes }}
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <h4 style="margin-left: 15px;"> <b>Redes Sociales </b> </h4>
                                </div>
                                <div class="row">

                                    <div class="col-sm-3 ">
                                        <div class="input-group form-group">
                                            <div class="input-group-prepend">
                                                <button class="btn btn-primary" type="button" style="height: 41px;
                                        width: 48px;"><i class="fa fa-linkedin" style="font-size: 23px;"></i></button>
                                            </div>

                                            {{form.perfiluser.linkedin }}
                                        </div>
                                    </div>
                                    <div class="col-sm-3 ">
                                        <div class="input-group form-group">
                                            <div class="input-group-prepend">
                                                <button class="btn btn-danger" type="button" style="height: 41px;
                                        width: 48px;"><i class="fa fa-youtube" style="font-size: 23px;"></i></button>
                                            </div>

                                            {{form.perfiluser.youtube }}
                                        </div>
                                    </div>
                                    <div class="col-sm-3 ">
                                        <div class="input-group form-group">
                                            <div class="input-group-prepend">
                                                <button class="btn btn-primary" type="button" style="height: 41px;
                                        width: 48px;"><i class="fa fa-facebook" style="font-size: 23px;"></i></button>
                                            </div>

                                            {{form.perfiluser.facebook }}
                                        </div>
                                    </div>
                                    <div class="col-sm-3 ">
                                        <div class="input-group form-group">
                                            <div class="input-group-prepend">
                                                <button class="btn btn-info" type="button" style="height: 41px;
                                        width: 48px;"><i class="fa fa-twitter"
                                                        style="font-size: 34px;margin-top: -8px;margin-left: -8px;"></i></button>
                                            </div>

                                            {{form.perfiluser.twitter }}
                                        </div>
                                    </div>
                                </div>

                            </div>
                        
                            <div class="row">

                                <div class="col-sm-offset-2 col-sm-5">
                                    
    
                                        <button type="submit" class="btn btn-lg btn-primary" id="submit">Actualizar
                                            Perfil </button>
                                        </label>
    
    
                                </div>
    
                            </div>
                        
                        </div>
                        


                </div>
                </form>

            </div>
        </div>
    </div>
</div>

</div>


{% endblock%}

{%block script%}

<link rel="stylesheet" href="{% static 'MedCongressApp/css/jquery-ui.min.css'%}">
<script src="{% static 'MedCongressApp/js/plugins/jquery-ui/jquery-ui.min.js'%}"></script>
<script src="{% static 'MedCongressAdmin/app-assets/vendors/js/editors/ckeditor/ckeditor.js'%}"></script>
<script src="{% static 'MedCongressAdmin/app-assets/js/scripts/editors/editor-ckeditor.js'%}"></script>
<script src="{% static 'MedCongressApp/js/lugar.js'%}"></script>
<script src="{% static 'MedCongressAdmin/assets/js/cropper.js'%}"></script>
<script>

    $('#myTabs a').click(function (e) {

        e.preventDefault()
        $(this).tab('show')
    })

    $(document).ready(function () {


        FiltrarLugar('#id_ubicacion-direccion', '#id_ubicacion-longitud', '#id_ubicacion-latitud');
        $('#id_ubicacion-direccion').keypress(function () {
            $('#id_ubicacion-latitud').val('');
            $('#id_ubicacion-longitud').val('');

        });

        $("#esp_div").hide();
        $("#cel_prof").hide();
        $("#new_cat").hide();
        if ($('#id_perfiluser-categoria option:selected').text() == 'Médico' || $('#id_perfiluser-categoria option:selected').text() == 'Residente') {

            $("#esp_div").show();
            $("#cel_prof").show();

            $("#id_perfiluser-especialidad").attr('required', 'True');
            $("#id_perfiluser-cel_profecional").attr('required', 'True');


        }
        else {
            $("#esp_div").hide();
            $("#cel_prof").hide();
            $("#id_perfiluser-especialidad").val('');
            $("#id_perfiluser-cel_profecional").val('');
            $("#id_perfiluser-especialidad").removeAttr('required')
            $("#id_perfiluser-cel_profecional").removeAttr('required')

        }
        if ($('#id_perfiluser-categoria option:selected').text() == 'Otra') {
            $("#new_cat").show();
            $("#id_categoria-nombre").attr('required', 'True');

        }
        else {
            $("#new_cat").hide();
            $("#id_categoria-nombre").val('')
            $("#id_categoria-nombre").removeAttr('required');
        }


        $('#id_perfiluser-categoria').change(function () {

            if ($('#id_perfiluser-categoria option:selected').text() == 'Médico' || $('#id_perfiluser-categoria option:selected').text() == 'Residente') {

                $("#esp_div").show();
                $("#cel_prof").show();
                $("#id_perfiluser-especialidad").attr('required', 'True')
                $("#id_perfiluser-cel_profecional").attr('required', 'True')
            }
            else {
                $("#id_perfiluser-especialidad").val('');
                $("#id_perfiluser-cel_profecional").val('');
                $("#esp_div").hide();
                $("#cel_prof").hide();
                $("#id_perfiluser-especialidad").removeAttr('required')
                $("#id_perfiluser-cel_profecional").removeAttr('required')

            }
            if ($('#id_perfiluser-categoria option:selected').text() == 'Otra') {
                $("#new_cat").show();
                $("#id_categoria-nombre").attr('required', 'True')

            }
            else {
                $("#new_cat").hide();
                $("#id_categoria-nombre").val('')
                $("#id_categoria-nombre").removeAttr('required')
            }

        });

        $('#pol').change(function () {
            if ($('#pol').prop('checked')) {
                $("#submit").removeAttr('disabled')
            }
            else {
                $("#submit").attr('disabled', 'disabled')
            }

        });


        /*
         * Point location on google map
         */
        // $('#get_map').click(function (e) {

        //     var address = $(PostCodeid).val();
        //     geocoder.geocode({'address': address}, function (results, status) {
        //         if (status == google.maps.GeocoderStatus.OK) {
        //             map.setCenter(results[0].geometry.location);
        //             marker.setPosition(results[0].geometry.location);
        //             $('#id_ubicacion-direccion').val(results[0].formatted_address);
        //             $('#id_ubicacion-latitud').val(marker.getPosition().lat());
        //             $('#id_ubicacion-longitud').val(marker.getPosition().lng());
        //         } else {
        //             alert("Geocode was not successful for the following reason: " + status);
        //         }
        //     });
        //     e.preventDefault();
        // });

        //Add listener to marker for reverse geocoding

        //     google.maps.event.addListener( map, "click", function(ele) {
        //     // codigo que crea el marcador
        //     new google.maps.Marker({
        //         map: map
        //     })
        // });


        // google.maps.event.addListener(map, 'click', function (event) {

        //     marker = new google.maps.Marker({
        //     map: map,
        //     draggable: true,
        //     position: event.latLng
        // });

        //     geocoder.geocode({'latLng': marker.getPosition()}, function (results, status) {
        //         if (status == google.maps.GeocoderStatus.OK) {
        //             if (results[0]) {
        //                 $('#id_ubicacion-direccion').val(results[0].formatted_address);
        //                 $('#id_ubicacion-latitud').val(marker.getPosition().lat());
        //                 $('#id_ubicacion-longitud').val(marker.getPosition().lng());
        //             }
        //         }
        //     });
        // });






    });

    function VerMapa() {

        $('.geomap').slideToggle();
        $('.mapa').slideToggle(1);
    }
    
    window.addEventListener('DOMContentLoaded', function () {
      var avatar = document.getElementById('avatar');
      var image = document.getElementById('image');
      var input = document.getElementById('input');
      var $progress = $('.progress');
      var $progressBar = $('.progress-bar');
      var $alert = $('.alert');
      var $modal = $('#modal1');
      var cropper;

      $('[data-toggle="tooltip"]').tooltip();

      input.addEventListener('change', function (e) {
        var files = e.target.files;
        var done = function (url) {
          input.value = '';
          image.src = url;
          $alert.hide();
          $modal.modal('show');
        };
        var reader;
        var file;
        var url;

        if (files && files.length > 0) {
		  file = files[0];
		 
			tipo_imagen=files[0].name.split('.');
			if(tipo_imagen[1]!='jpg' && tipo_imagen[1]!='png')
			{
				
				swal("Cancelado", "Solo admimite archivos .jpg y .png.", "error");
				return;	
			}
          if (URL) {
            done(URL.createObjectURL(file));
          } else if (FileReader) {
            reader = new FileReader();
            reader.onload = function (e) {
              done(reader.result);
            };
            reader.readAsDataURL(file);
          }
        }
      });

      $modal.on('shown.bs.modal', function () {
		

		$('#image').width($modal.width());
		
		
        cropper = new Cropper(image, {
          aspectRatio: 500/600,
		  viewMode: 1,
		  
		  
		  ready: function () {
            //Should set crop box data first here
            cropper.setCropBoxData(cropBoxData).setCanvasData(canvasData);
          }
        });
      }).on('hidden.bs.modal', function () {
        cropper.destroy();
        cropper = null;
      });

      document.getElementById('crop').addEventListener('click', function () {
        var initialAvatarURL;
        var canvas;

        $modal.modal('hide');

        if (cropper) {
          canvas = cropper.getCroppedCanvas({
            width: 500,
            height: 600,
          });
          initialAvatarURL = avatar.src;
          avatar.src = canvas.toDataURL();
          $('#prueba').val(canvas.toDataURL());
		  $progress.show();
		
		  $alert.removeClass('alert-success alert-warning');  
		  $alert.show().addClass('alert-success').text('Nueva Imagen Cargada');
      
        }
      });
    });
</script>
{%endblock%}